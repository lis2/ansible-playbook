---
- hosts: all
  vars:
    home: /Users/lis2
    ruby: 2.0.0
    applications:
      - google-chrome
      - firefox
      - sublime-text
      - vlc
      - iterm2
      - sequel-pro
      - skype
      - dash
      - filezilla
      - viber
      - teamviewer
      - spotify
      - virtualbox
      - libreoffice
      - slack
      - subtitles
      - evernote
      - google-hangouts
      - alfred
      - appcleaner
      - transmission
      - dropbox
      - opennx
      - knox
      - xquartz
      - vyprvpn
      - 1password
       
    brew:
      - wget
      - git
      - ruby-build
      - mysql
      - tmux
      - mysql
      - macvim
      - node
      - rbenv
      - zeromq
      - sqlite
      - scala
      - redis
      - htop-osx
      - the_silver_searcher
      - elixir
      - mongodb
      - docker
      - go
      - tig
      
  tasks:  
    - name: Check for installed apps(casks)
      shell: brew list | grep {{ item }}
      register: installed_brews
      with_items: brew
      ignore_errors: true
 
    - name: Install apps with brew
      shell: brew install {{ item }}
      with_items: brew
      when: "{{ item not in installed_brews.results|map(attribute='stdout') }}"

    - name: Check for installed apps(casks)
      shell: brew cask list | grep {{ item }}
      register: installed_applications
      with_items: applications
      ignore_errors: true
 
    - name: Install apps with brew-cask
      shell: brew cask install {{ item }}
      with_items: applications
      when: "{{ item not in installed_applications.results|map(attribute='stdout') }}"
    - name: Check for installed apps(casks)
      shell: brew cask list | grep {{ item }}
      register: installed_applications
      with_items: applications
      ignore_errors: true
 
    - name: Install apps with brew-cask
      shell: brew cask install {{ item }}
      with_items: applications
      when: "{{ item not in installed_applications.results|map(attribute='stdout') }}"

    - name: Clone dotfiles
      git: repo=https://github.com/lis2/{{ item }}.git dest={{ home }}/{{ item }} force=no update=no
      with_items:
        - dotfiles       

    - name: Run symlink.rb
      shell: ruby {{ home }}/dotfiles/symlink.rb
    - name: install rvm
      shell: \curl -L https://get.rvm.io | bash -s stable --autolibs=3 creates=~/.rvm

    - name: install ruby
      shell: ~/.rvm/bin/rvm install --default {{ ruby }} creates=~/.rvm/rubies/{{ ruby }}
